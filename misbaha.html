<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>المسبحة الملكية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Amiri', serif; /* تطبيق الخط الأميري */
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
        }

        /* --- تصميم الكرة الزجاجية --- */
        .orb-stage {
            position: relative;
            width: 280px;
            height: 280px;
            display: flex;
            justify-content: center;
            align-items: center;
            filter: drop-shadow(0 25px 35px rgba(0,0,0,0.6));
            margin: 0 auto;
        }

        .glass-orb {
            width: 100%;
            height: 100%;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.01) 50%, rgba(0,0,0,0.4) 100%);
            box-shadow: 
                inset -5px -5px 20px rgba(0,0,0,0.7),
                inset 5px 5px 20px rgba(255,255,255,0.25),
                inset 0 0 0 2px rgba(255,255,255,0.05),
                0 0 1px rgba(0,0,0,0.8);
            z-index: 10;
            transform: translateZ(0);
        }

        .glass-orb:active { transform: scale(0.98); }

        /* الانعكاسات */
        .reflection-main {
            position: absolute;
            top: 5%;
            left: 10%;
            width: 40%;
            height: 25%;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.3) 40%, transparent 70%);
            filter: blur(4px);
            z-index: 50;
            pointer-events: none;
            transform: rotate(-25deg);
        }
        
        .rim-light {
            position: absolute;
            bottom: 3%;
            right: 12%;
            width: 60%;
            height: 30%;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, rgba(192, 233, 255, 0.25) 0%, transparent 60%);
            filter: blur(6px);
            z-index: 50;
            pointer-events: none;
            transform: rotate(-10deg);
        }

        /* --- السائل --- */
        .liquid-container {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 0%;
            z-index: 20;
            transition: height 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .liquid-body {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, #020c1b, #0a2351 40%, #1d4ed8 100%);
        }

        .liquid-surface {
            position: absolute; top: -10px; left: -10%; width: 120%; height: 20px;
            background: radial-gradient(ellipse at center, rgba(96, 165, 250, 0.5) 0%, rgba(29, 78, 216, 0.8) 70%, transparent 100%);
            border-radius: 50%;
            filter: blur(1px);
            animation: ripple 4s ease-in-out infinite alternate;
        }

        @keyframes ripple {
            0% { transform: scaleY(1); }
            100% { transform: scaleY(1.2); }
        }

        /* الفقاعات */
        .bubble-real {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.1) 60%, transparent 100%);
            border-radius: 50%;
            bottom: -20px;
            z-index: 25;
            pointer-events: none;
        }

        /* --- النصوص داخل الكرة --- */
        .glass-text-container {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 60; pointer-events: none;
            text-shadow: 0 4px 10px rgba(0,0,0,0.6);
        }

        .zikr-text {
            font-size: 1.8rem; /* تكبير الخط قليلاً لجمالية الأميري */
            font-weight: 700;
            color: #bae6fd;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .count-digit {
            font-size: 5.5rem; /* أرقام كبيرة وواضحة */
            font-weight: 700;
            line-height: 1;
            font-family: 'Amiri', serif;
        }

        .target-text {
            font-size: 1.1rem;
            color: #94a3b8;
            margin-top: 0.5rem;
            font-weight: 400;
        }

        /* --- اللوحات والأزرار --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .tab-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            font-size: 1.1rem; /* تكبير الخط */
            transition: all 0.3s ease;
            color: #94a3b8;
            border: 1px solid transparent;
            font-weight: 700;
        }

        .tab-btn.active {
            background: rgba(56, 189, 248, 0.15);
            color: #e0f2fe;
            border-color: rgba(56, 189, 248, 0.3);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.1);
        }

        .glass-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            width: 100%;
            outline: none;
            text-align: center;
            font-size: 1.2rem;
            font-family: 'Amiri', serif;
        }
        .glass-input:focus { border-color: #38bdf8; }

        body.gold-mode .liquid-body { background: linear-gradient(to top, #451a03, #b45309, #f59e0b); }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-screen w-full flex flex-col items-center p-4">

    <header class="w-full max-w-md flex flex-col items-center gap-4 mb-6 z-20">
        <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-200 to-white drop-shadow-lg mt-4">
            المسبحة
        </h1>
        
        <div class="glass-panel p-1 flex justify-between w-full">
            <button onclick="switchMode('open')" id="tab-open" class="tab-btn flex-1">١٠٠ مره</button>
            <button onclick="switchMode('zahra')" id="tab-zahra" class="tab-btn flex-1">تسبيح الزهراء</button>
            <button onclick="switchMode('custom')" id="tab-custom" class="tab-btn flex-1">مخصص</button>
        </div>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center w-full relative">
        
        <div id="custom-panel" class="absolute top-0 w-full max-w-xs glass-panel p-4 z-30 hidden fade-in">
            <div class="flex flex-col gap-3">
                <input type="text" id="custom-text-input" placeholder="اكتب الذكر هنا..." class="glass-input">
                <div class="flex gap-2">
                    <input type="number" id="custom-count-input" placeholder="العدد" class="glass-input w-24">
                    <button onclick="startCustomMode()" class="bg-sky-600 hover:bg-sky-500 text-white rounded-xl px-4 flex-grow transition-colors font-bold text-lg">بدء</button>
                </div>
            </div>
        </div>

        <div class="orb-stage" id="orb-stage">
            <div id="orb" class="glass-orb" onclick="handleTap()">
                <div class="reflection-main"></div>
                <div class="rim-light"></div>
                
                <div id="liquid-container" class="liquid-container">
                    <div class="liquid-body"></div>
                    <div class="liquid-surface"></div>
                </div>
                
                <div id="bubbles-container" class="absolute inset-0 pointer-events-none overflow-hidden rounded-full"></div>

                <div class="glass-text-container">
                    <span id="zikr-display" class="zikr-text">سبحان الله</span>
                    <span id="counter" class="count-digit text-white">٠</span>
                    <span id="target-label" class="target-text"></span>
                </div>
            </div>
        </div>

    </main>

    <div class="w-full max-w-xs mb-8 z-20 flex gap-3">
        <button onclick="resetCurrentMode()" class="w-full glass-panel py-3 text-rose-300 hover:bg-white/5 transition flex justify-center items-center gap-2 text-xl font-bold">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
            إعادة ضبط
        </button>
    </div>

    <script>
        // --- دالة تحويل الأرقام إلى العربية ---
        function toArabicNum(num) {
            const map = ["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];
            return num.toString().replace(/\d/g, d => map[d]);
        }

        // --- State Management ---
        const MODES = {
            OPEN: 'open',
            ZAHRA: 'zahra',
            CUSTOM: 'custom'
        };

        let state = {
            mode: MODES.OPEN,
            count: 0,
            target: 0, 
            zikrText: "سبحان الله",
            
            zahraPhase: 0,
            zahraConfig: [
                { text: "الله أكبر", target: 34 },
                { text: "الحمد لله", target: 33 },
                { text: "سبحان الله", target: 33 }
            ],
            
            customText: "أكتب الذكر هنا",
            customTargetNum: 100
        };

        const els = {
            counter: document.getElementById('counter'),
            zikrDisplay: document.getElementById('zikr-display'),
            targetLabel: document.getElementById('target-label'),
            liquid: document.getElementById('liquid-container'),
            bubbles: document.getElementById('bubbles-container'),
            customPanel: document.getElementById('custom-panel'),
            orbStage: document.getElementById('orb-stage'),
            tabs: {
                open: document.getElementById('tab-open'),
                zahra: document.getElementById('tab-zahra'),
                custom: document.getElementById('tab-custom')
            },
            inputs: {
                text: document.getElementById('custom-text-input'),
                count: document.getElementById('custom-count-input')
            }
        };

        function init() {
            switchMode(MODES.OPEN);
        }

        function switchMode(newMode) {
            state.mode = newMode;
            state.count = 0;
            document.body.classList.remove('gold-mode');

            Object.values(els.tabs).forEach(tab => tab.classList.remove('active'));
            els.tabs[newMode].classList.add('active');

            els.customPanel.classList.add('hidden');
            els.orbStage.style.opacity = '1';

            if (newMode === MODES.OPEN) {
                state.target = 0;
                state.zikrText = "تسبيح";
                updateUI();
            } else if (newMode === MODES.ZAHRA) {
                state.zahraPhase = 0;
                setZahraPhase(0);
            } else if (newMode === MODES.CUSTOM) {
                els.customPanel.classList.remove('hidden');
                els.orbStage.style.opacity = '0.3';
                els.inputs.text.value = state.customText;
                els.inputs.count.value = state.customTargetNum;
            }
        }

        function setZahraPhase(phaseIndex) {
            if (phaseIndex > 2) {
                completeGoal();
                return;
            }
            state.zahraPhase = phaseIndex;
            state.count = 0;
            state.target = state.zahraConfig[phaseIndex].target;
            state.zikrText = state.zahraConfig[phaseIndex].text;
            updateUI();
        }

        function startCustomMode() {
            const text = els.inputs.text.value || "ذكر";
            const num = parseInt(els.inputs.count.value) || 33;
            
            state.customText = text;
            state.customTargetNum = num;
            state.target = num;
            state.zikrText = text;
            state.count = 0;
            
            els.customPanel.classList.add('hidden');
            els.orbStage.style.opacity = '1';
            updateUI();
        }

        function handleTap() {
            if (state.mode === MODES.CUSTOM && !els.customPanel.classList.contains('hidden')) return;

            if (state.target > 0 && state.count >= state.target) {
                if (state.mode === MODES.ZAHRA) {
                    triggerHaptic([30, 50]);
                    setZahraPhase(state.zahraPhase + 1);
                } else {
                    resetCurrentMode(); 
                }
                return;
            }

            state.count++;
            triggerHaptic(10);
            createBubble();
            updateUI(true);

            if (state.target > 0 && state.count === state.target) {
                if (state.mode === MODES.ZAHRA && state.zahraPhase < 2) {
                    triggerHaptic(40);
                    els.targetLabel.innerText = "اكتمل - اضغط للمتابعة";
                    els.targetLabel.style.color = "#fbbf24";
                } else {
                    completeGoal();
                }
            }
        }

        function resetCurrentMode() {
            state.count = 0;
            document.body.classList.remove('gold-mode');
            if (state.mode === MODES.ZAHRA) {
                setZahraPhase(0);
            } else {
                updateUI();
            }
        }

        function updateUI(animate = false) {
            // استخدام الأرقام العربية هنا
            els.counter.innerText = toArabicNum(state.count);
            els.zikrDisplay.innerText = state.zikrText;
            els.targetLabel.style.color = ""; 

            let percent = 0;
            if (state.target === 0) {
                els.targetLabel.innerText = "العدد مفتوح";
                percent = (state.count % 100) + 10;
            } else {
                // عرض الهدف بالأرقام العربية
                els.targetLabel.innerText = `${toArabicNum(state.count)} من ${toArabicNum(state.target)}`;
                percent = (state.count / state.target) * 100;
            }
            
            els.liquid.style.height = `${Math.min(percent, 100)}%`;
        }

        function completeGoal() {
            document.body.classList.add('gold-mode');
            triggerHaptic([50, 50, 50, 50]);
            for(let i=0; i<10; i++) setTimeout(createBubble, i*100);

            if (state.mode === MODES.ZAHRA) {
                 els.targetLabel.innerText = "تقبل الله أعمالكم";
                 els.zikrDisplay.innerText = "اكتملت التسبيحة";
            }
        }

        function createBubble() {
            const b = document.createElement('div');
            b.className = 'bubble-real';
            const size = Math.random() * 15 + 5;
            b.style.width = `${size}px`;
            b.style.height = `${size}px`;
            b.style.left = `${Math.random() * 80 + 10}%`;
            
            const duration = Math.random() * 2 + 1;
            
            b.animate([
                { bottom: '-20px', opacity: 0, transform: 'translateX(0)' },
                { opacity: 0.6, offset: 0.2 },
                { transform: `translateX(${Math.random()*40 - 20}px)`, offset: 0.6 },
                { bottom: '100%', opacity: 0 }
            ], { duration: duration * 1000, easing: 'ease-out' });

            els.bubbles.appendChild(b);
            setTimeout(() => b.remove(), duration * 1000);
        }

        function triggerHaptic(pattern) {
            if (navigator.vibrate) navigator.vibrate(pattern);
        }

        init();
    </script>
</body>
</html>
